---
section: Docs
subtitle: API
chapter: Annotation
permalink: docs/api/annotation/index.html
layout: submenu
---

# Annotation Service #

The Aperture Tiles Annotation Service REST API is based on the Aperture Tiles Binning API. Annotations are submitted into tiles and aggregated through a given range of levels based on bin-index. Annotations can be written, modified and removed in real time.

## <a name="data-types"></a> Data Types ##

### <a name="annotation"></a> Annotation ###

A single annotation received from a GET request or submitted in a write, modify or remove POST request.

<div class="details props">
	<div class="innerProps">
		<h3 class="sectionTitle">
			Method Detail
		</h3>
		
		<ul class="methodDetail" id="MethodDetail">
			<dl class="detailList params">
				<dt class="heading">Parameters:</dt>
				
				<dt>
					<span class="light fixedFont">{Integer}</span> <b>level</b>
				</dt>
				<dd>Native zoom level in which the annotation is inserted.</dd>
				
				<dt>
					<span class="light fixedFont">{Real or Array of Real}</span> <b>x</b>
				</dt>
				<dd>Raw x data coordinate of the annotation. Either a Real or an Array containing two Real [min, max] for range-based annotations.</dd>
				
				<dt>
					<span class="light fixedFont">{Real or Array of Real}</span> <b>y</b>
				</dt>
				<dd>Raw y data coordinate of the annotation. Either a Real or an Array containing two Real [min, max] for range-based annotations.</dd>
				
				<dt>
					<span class="light fixedFont">{JSON}</span> <b>range</b>
				</dt>
				<dd><em>min</em> and <em>max</em> key value pairs indicating the zoom-level aggregation range (inclusive). Given as Integers.</dd>
						
				<dt>
					<span class="light fixedFont">{String}</span> <b>group</b>
				</dt>
				<dd>Exclusive groupings by which annotations can be filtered.</dd>
						
				<dt>
					<span class="light fixedFont">{JSON}</span> <b>data</b>
				</dt>
				<dd>Additional information to be stored within the tile.</dd>
						
				<dt>
					<span class="light fixedFont">{JSON}</span> <b>certificate</b>
				</dt>
				<dd>Contains an RFC4122 version 4 compliant UUID and a Unix timestamp. Returned by the server upon successful write and modify operations.</dd>
			</dl>
		</ul>
	</div>
</div>

Example:

```json
{
    level: 6,
    x: 73.35,
    y: -125.6,
    range: {
        min: 0,
        max: 6
    }
    group: "Urgent",   
    data: {
        comment: … ,
        author: … ,
        date: … 
    },
    certificate: { … }
}
```

### <a name="annotation-tile"></a> Annotation Tile ###

A collection of annotations from a single GET request. Contains all annotations (aggregated by bin-key) that pass through the current [filter configuration](../webservices/#filter configuration).

<div class="details props">
	<div class="innerProps">
		<h3 class="sectionTitle">
			Method Detail
		</h3>
		
		<ul class="methodDetail" id="MethodDetail">
			<dl class="detailList params">
				<dt class="heading">Parameters:</dt>
				
				<dt>
					<span class="light fixedFont">{JSON}</span> <b>title</b>
				</dt>
				<dd>The respective tile index containing the level, x index and y index (where 0,0 is bottom left).</dd>
				
				<dt>
					<span class="light fixedFont">{JSON}</span> <b>annotations</b>
				</dt>
				<dd>An array of annotations aggregated by bin-key.</dd>
			</dl>
		</ul>
	</div>
</div>

Example:

```json
{
	index : {
		level: 7,
		xIndex: 8,
		yIndex: 4
	},
	tile : {
		values: [
			{
				value: [
					level: 7,
					x: 73.35,
					y: -125.6,
					range: {
						min: 0,
						max: 9
					}
					group: "Urgent",   
					data: {
						comment: … ,
						author: … ,
						date: … 
					},
					certificate: { … }
				]
			}
		]
	}
}
```

### <a name="annotation-certificate"></a> Annotation Certificate ###

An Annotation Certificate is comprised of the UUID and timestamp from a successful POST request. The certificate is used during remove and modify operations to ensure client-server coherency in the event of live editing conflicts. When a certificate in a supplied annotation does not match that held by the server, the request is ignored and an error status is returned to the client.

<div class="details props">
	<div class="innerProps">
		<h3 class="sectionTitle">
			Method Detail
		</h3>
		
		<ul class="methodDetail" id="MethodDetail">
			<dl class="detailList params">
				<dt class="heading">Parameters:</dt>
				
				<dt>
					<span class="light fixedFont">{String}</span> <b>uuid</b>
				</dt>
				<dd>An RFC 4122 Version 4 compliant UUID generated by the server.</dd>
				
				<dt>
					<span class="light fixedFont">{String}</span> <b>timestamp</b>
				</dt>
				<dd>A Unix timestamp generated by the server.</dd>
			</dl>
		</ul>
	</div>
</div>

Example:

```json
{
    uuid: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
    timestamp: "1401830862"
}
```

## <a name="web-services"></a> Web Services ##

Web service paths are relative to a common base URL.  For example, assuming the hostname *localhost* and port *8080*, the URLs of the various services would be:

- `https://localhost:8080/{version}/annotation/{layer}/{uuid}/{level}/{x}/{y}.{ext}`
- `https://localhost:8080/annotation/{layer}/{level}/{x}/{y}.{ext}`
- `https://localhost:8080/{version}/annotation`
- `https://localhost:8080/annotation`
- `https://localhost:8080/{version}/layer/{layer}`
- `https://localhost:8080/layer/{layer}`
- `https://localhost:8080/{version}/layer`
- `https://localhost:8080/layer`

### <a name="read-annotation-tile"></a> Read Annotation Tile ###

Returns an Annotation Tile for a specified filter configuration UUID, annotation layer, level and tile x and y.

<div class="props">
	<h3 class="sectionTitle">Method Summary</h3>
		<nav>
			<table class="summaryTable">
				<thead>
					<tr>
						<th scope="col">Attributes</th>
						<th scope="col">Description</th>
					</tr>
				</thead>
				
				<tbody>
					<tr class='item0'>
						<td class="attributes">URL</td>
						<td class="nameDescription">
							<div class="description">/{version}/annotation/{layerId}/{level}/{x}/{y}/{z}.{ext}</div>
						</td>
					</tr>
					
					<tr class='item1'>
						<td class="attributes">Method</td>
						<td class="nameDescription">
							<div class="description">`GET`</div>
						</td>
					</tr>
					
					<tr class='item2'>
						<td class="attributes">Output MIME Type</td>
						<td class="nameDescription">
							<div class="description">application/json</div>
						</td>
					</tr>
					
					<tr class='item3'>
						<td class="attributes">Output</td>
						<td class="nameDescription">
							<div class="description">Annotation Tile</div>
						</td>
					</tr>
					
				</tbody>
			</table>
		</nav>
</div>

<div class="details props">
	<div class="innerProps">
		<h3 class="sectionTitle">
			Method Detail
		</h3>
		
		<ul class="methodDetail" id="MethodDetail">
			<dl class="detailList params">
				<dt class="heading">URL Parameters:</dt>
				
				<dt>
					<b>layer</b>
				</dt>
				<dd>Annotation layer ID.</dd>
				
				<dt>
					<b>uuid</b>
				</dt>
				<dd>Filter configuration UUID. Submit <em>default</em> to use the default server filter configuration.</dd>
				
				<dt>
					<b>level</b>
				</dt>
				<dd>Zoom level, where 0 is highest level of aggregation.</dd>
				
				<dt>
					<b>x</b>
				</dt>
				<dd>Horizontal tile index, where 0 represents the leftmost column of tiles.</dd>
						
				<dt>
					<b>y</b>
				</dt>
				<dd>Vertical tile index, where 0 represents the bottommost row of tiles.</dd>
						
				<dt>
					<b>.ext</b>
				</dt>
				<dd>The extension of the annotation format. Only JSON is currently supported.</dd>
			</dl>
		</ul>
	</div>
</div>

Example request:

```http
GET http://localhost:8080/instagram/rest/v1.0/annotation/parlor-annotations/4/1/2/3.json
```

Example response:

```json
{
	index : {
		level: 7,
		xIndex: 8,
		yIndex: 4
	},
	tile : {
		values: [
			{
				value: [
					level: 7,
					x: 73.35,
					y: -125.6,
					range: {
						min: 0,
						max: 9
					}
					group: "Urgent",   
					data: {
						comment: … ,
						author: … ,
						date: … 
					},
					certificate: { … }
				]
			}
		]
	}
}
```

### <a name="write-annotation"></a> Write Annotation ###

Submits a new annotation to be written to the server. Upon success, a certificate containing the UUID and timestamp is returned to the client.

<div class="props">
	<h3 class="sectionTitle">Method Summary</h3>
		<nav>
			<table class="summaryTable">
				<thead>
					<tr>
						<th scope="col">Attributes</th>
						<th scope="col">Description</th>
					</tr>
				</thead>
				
				<tbody>
					<tr class='item0'>
						<td class="attributes">URL</td>
						<td class="nameDescription">
							<div class="description">/{version}/annotation/{layerId}/</div>
						</td>
					</tr>
					
					<tr class='item1'>
						<td class="attributes">Method</td>
						<td class="nameDescription">
							<div class="description">`POST`</div>
						</td>
					</tr>
					
					<tr class='item2'>
						<td class="attributes">Output MIME Type</td>
						<td class="nameDescription">
							<div class="description">application/json</div>
						</td>
					</tr>
					
					<tr class='item3'>
						<td class="attributes">Output</td>
						<td class="nameDescription">
							<div class="description">AnnotationCertificate</div>
						</td>
					</tr>
					
				</tbody>
			</table>
		</nav>
</div>

<div class="props">
	<h3 class="sectionTitle">Method Detail</h3>
		<nav>
			<table class="summaryTable">
				<thead>
					<tr>
						<th scope="col">Request Parameter</th>
						<th scope="col">Description</th>
						<th scope="col">Data Type</th>
						<th scope="col">Single/Multiple</th>
						<th scope="col">Required?</th>
					</tr>
				</thead>
				
				<tbody>
					<tr class='item0'>
						<td class="attributes">type</td>
						<td class="nameDescription">
							<div class="description">"write"</div>
						</td>
						<td class="nameDescription">
							<div class="description">String</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>
					
					<tr class='item1'>
						<td class="attributes">layer</td>
						<td class="nameDescription">
							<div class="description">annotation layer id</div>
						</td>
						<td class="nameDescription">
							<div class="description">String</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>
					
					<tr class='item2'>
						<td class="attributes">annotation</td>
						<td class="nameDescription">
							<div class="description">annotation</div>
						</td>
						<td class="nameDescription">
							<div class="description">JSON</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>					
				</tbody>
			</table>
		</nav>
</div>

Example request:

```html
POST http://localhost:8080/instagram/rest/v1.0/annotation/parlor-annotations/
```

```json
{
    type: "write"
    layer: , "annotation-test-layer-id",
    annotation: {
        level: 6,
        x: 73.35,
        y: -125.6,
        range: {
            min: 0,
            max: 6
        }
        group: "Urgent",   
        data: {
            comment: … ,
            author: … ,
            date: … 
        }
    }
}
```

Example response:

```json
{
    uuid: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
    timestamp: "1401830862"
}
```

### <a name="modify-annotation"></a> Modify Annotation ###

Submits a modify request to the server. If the certificate in the annotation state is valid, the operation is processed and a new certificate is returned.

<div class="props">
	<h3 class="sectionTitle">Method Summary</h3>
		<nav>
			<table class="summaryTable">
				<thead>
					<tr>
						<th scope="col">Attributes</th>
						<th scope="col">Description</th>
					</tr>
				</thead>
				
				<tbody>
					<tr class='item0'>
						<td class="attributes">URL</td>
						<td class="nameDescription">
							<div class="description">/{version}/annotation/{layerId}/</div>
						</td>
					</tr>
					
					<tr class='item1'>
						<td class="attributes">Method</td>
						<td class="nameDescription">
							<div class="description">`POST`</div>
						</td>
					</tr>
					
					<tr class='item2'>
						<td class="attributes">Output MIME Type</td>
						<td class="nameDescription">
							<div class="description">application/json</div>
						</td>
					</tr>
					
					<tr class='item3'>
						<td class="attributes">Output</td>
						<td class="nameDescription">
							<div class="description">AnnotationCertificate</div>
						</td>
					</tr>
					
				</tbody>
			</table>
		</nav>
</div>

<div class="props">
	<h3 class="sectionTitle">Method Detail</h3>
		<nav>
			<table class="summaryTable">
				<thead>
					<tr>
						<th scope="col">Request Parameter</th>
						<th scope="col">Description</th>
						<th scope="col">Data Type</th>
						<th scope="col">Single/Multiple</th>
						<th scope="col">Required?</th>
					</tr>
				</thead>
				
				<tbody>
					<tr class='item0'>
						<td class="attributes">type</td>
						<td class="nameDescription">
							<div class="description">"modify"</div>
						</td>
						<td class="nameDescription">
							<div class="description">String</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>
					
					<tr class='item1'>
						<td class="attributes">layer</td>
						<td class="nameDescription">
							<div class="description">annotation layer id</div>
						</td>
						<td class="nameDescription">
							<div class="description">String</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>
					
					<tr class='item2'>
						<td class="attributes">current</td>
						<td class="nameDescription">
							<div class="description">The annotation after modification. Must contain a valid certificate key.</div>
						</td>
						<td class="nameDescription">
							<div class="description">JSON</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>					
				</tbody>
			</table>
		</nav>
</div>

Example request:

```html
POST http://localhost:8080/instagram/rest/v1.0/annotation/parlor-annotations/
```

```json
{
    type: "write"
    layer: , "annotation-test-layer-id",
    annotation : {
        level: 6,
        x: 73.35,
        y: -125.6,
        range: {
            min: 0,
            max: 6
        }
        group: "Urgent",   
        data: {
            comment: … ,
            author: … ,
            date: … 
        },
        certificate: {
            uuid: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
            timestamp: "1401830862"
        }      
    }
}
```

Example response:

```json
{
    uuid: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
    timestamp: "1401830862"
}
```

### <a name="remove-annotation"></a> Remove Annotation ###

Submits a removal request to the server. If the certificate is valid, the operation will be processed and a success status will be returned.

<div class="props">
	<h3 class="sectionTitle">Method Summary</h3>
		<nav>
			<table class="summaryTable">
				<thead>
					<tr>
						<th scope="col">Attributes</th>
						<th scope="col">Description</th>
					</tr>
				</thead>
				
				<tbody>
					<tr class='item0'>
						<td class="attributes">URL</td>
						<td class="nameDescription">
							<div class="description">/{version}/annotation/{layerId}/</div>
						</td>
					</tr>
					
					<tr class='item1'>
						<td class="attributes">HTTP Method</td>
						<td class="nameDescription">
							<div class="description">`POST`</div>
						</td>
					</tr>
					
					<tr class='item2'>
						<td class="attributes">Output MIME Type</td>
						<td class="nameDescription">
							<div class="description">application/json</div>
						</td>
					</tr>
					
					<tr class='item3'>
						<td class="attributes">Output</td>
						<td class="nameDescription">
							<div class="description">JSON</div>
						</td>
					</tr>
					
				</tbody>
			</table>
		</nav>
</div>

<div class="props">
	<h3 class="sectionTitle">Method Detail</h3>
		<nav>
			<table class="summaryTable">
				<thead>
					<tr>
						<th scope="col">Request Parameter</th>
						<th scope="col">Description</th>
						<th scope="col">Data Type</th>
						<th scope="col">Single/Multiple</th>
						<th scope="col">Required?</th>
					</tr>
				</thead>
				
				<tbody>
					<tr class='item0'>
						<td class="attributes">type</td>
						<td class="nameDescription">
							<div class="description">"write"</div>
						</td>
						<td class="nameDescription">
							<div class="description">String</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>
					
					<tr class='item1'>
						<td class="attributes">layer</td>
						<td class="nameDescription">
							<div class="description">annotation layer id</div>
						</td>
						<td class="nameDescription">
							<div class="description">String</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>
					
					<tr class='item2'>
						<td class="attributes">certificate</td>
						<td class="nameDescription">
							<div class="description">The certificate of the annotation to be removed.</div>
						</td>
						<td class="nameDescription">
							<div class="description">JSON</div>
						</td>
						<td class="nameDescription">
							<div class="description">Single</div>
						</td>
						<td class="nameDescription">
							<div class="description">Yes</div>
						</td>
					</tr>					
				</tbody>
			</table>
		</nav>
</div>

Example request:

```html
POST http://localhost:8080/instagram/rest/v1.0/annotation/parlor-annotations/
```

```json
{
    type: "write"
    layer: , "annotation-test-layer-id",
    certificate: {
        uuid: "f47ac10b-58cc-4372-a567-0e02b2c3d479",
        timestamp: "1401830862"
    }
}
```

Example response:

```json
{
}
```